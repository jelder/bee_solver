<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
  </head>
  <body>

    <form id="inputForm">
      <div>
        <label for="centerLetter">Center Letter:</label>
        <input type="text" id="centerLetter" required minlength="1" maxlength="1" placeholder="a">
      </div>
      <div>
        <label for="outerLetters">Outer Letters:</label>
        <input type="text" id="outerLetters" required minlength="6" maxlength="6" placeholder="zntcia">
      </div>
    </form>

    <script type="module">
      import init, { get_plays } from './pkg/bee_solver.js';
      const form = document.getElementById("inputForm");
      const centerLetterInput = document.getElementById("centerLetter");
      const outerLettersInput = document.getElementById("outerLetters");

      async function updateTable() {
        await init();
        const centerLetter = centerLetterInput.value.trim();
        const outerLetters = outerLettersInput.value.trim();

        if (!centerLetter || !outerLetters) return;

        const plays = get_plays(centerLetter, outerLetters);

        // Group plays by score
        const groupedByScore = plays.reduce((acc, play) => {
          if (!acc[play.score]) {
            acc[play.score] = [];
          }
          acc[play.score].unshift(play);
          return acc;
        }, {});

        // Remove existing table if any
        const existingTable = document.querySelector("table");
        if (existingTable) {
          existingTable.remove();
        }

        // Create a new table
        const table = document.createElement("table");
        table.border = "0";

        // Populate table rows
        for (const [score, plays] of Object.entries(groupedByScore).reverse()) {
          const row = table.insertRow();
          const scoreCell = row.insertCell();
          scoreCell.textContent = score;

          const wordCell = row.insertCell();
          wordCell.textContent = plays
            .map((play) => (play.is_pangram ? `<strong>${play.word}</strong>` : play.word))
            .join(", ");
          wordCell.innerHTML = wordCell.textContent;
        }

        // Append the table to the body
        document.body.appendChild(table);
      }

      form.addEventListener("input", updateTable);
    </script>
  </body>
</html>
